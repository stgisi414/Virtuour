<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Virtual Tour Guide</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

    <script>
        // This function is now guaranteed to exist when Google Maps calls for it.
        function initMap() {
            // We'll use an event to signal to our main.js module that the map is ready.
            window.dispatchEvent(new CustomEvent('map-ready'));
        }
    </script>

    <script>
      (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries","places,directions");a.src=`https://maps.googleapis.com/maps/api/js?key=AIzaSyAJ6YHA6SlQgqEYvJsR7t5ilMOkWiYnO&`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})
      ({
        key: "AIzaSyAJ6YHA6SlQgqEYvJsR7t5ilMOkWiYnO",
        v: "weekly",
      });
    </script>
    <script>
      // Your existing initMap function
      async function initMap() {
        const { Map } = await google.maps.importLibrary("maps");
        const { StreetViewPanorama } = await google.maps.importLibrary("streetView");

        // The rest of your initMap function can go here
        // For example, initializing the StreetViewPanorama
        streetView = new StreetViewPanorama(document.getElementById('streetview-container'), {
          position: { lat: 40.7291, lng: -73.9965 }, // Default start
          pov: { heading: 165, pitch: 0 },
          zoom: 1,
          visible: false,
          addressControl: false,
          linksControl: false,
          fullscreenControl: false,
          enableCloseButton: false,
        });
      }

      initMap(); 
    </script>

</head>

<body>
    <header>
        <h1>AI Virtual Tour Guide</h1>
    </header>

    <main>
        <div id="tour-setup">
            <input type="text" id="destinationInput" placeholder="Enter a city (e.g., 'Rome')">
            <button id="generateTourButton">Generate Tour</button>
        </div>

        <div id="streetview-container"></div>

        <div id="tour-information" class="hidden">
            <div id="slideshow-container"></div>
            <div id="subtitles-container"></div>
        </div>

        <div id="loading-indicator" class="hidden">
            <div class="spinner"></div>
            <p id="loading-text">Generating Itinerary...</p>
        </div>
    </main>

    <script src="main.js" type="module"></script>
</body>

</html>